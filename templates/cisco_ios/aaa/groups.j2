{% if 'aaa' in vars and 'groups' in vars['aaa'] -%}
{% for group in vars['aaa']['groups'] -%}
- parents:
  - aaa group server {{ vars['aaa']['groups'][group]['type'] }} {{ vars['aaa']['groups'][group]['name'] }}
  lines:
  {% if 'servers' in vars['aaa']['groups'][group] -%}
  {% for server in vars['aaa']['groups'][group]['servers'] -%}
  {% if server['private'] -%}
  - " server-private {{ server['ip'] }} key {{ server['encryption_type'] }} {{ server['key'] }}"
  {% else %}
  - " server {{ server['ip'] }} key {{ server['encryption_type'] }} {{ server['key'] }}"
  {% endif -%}
  {% endfor -%}
  {% endif -%}
  {% if 'forwarding_vrf' in vars['aaa']['groups'][group] -%}
  - " ip vrf forwarding {{ vars['aaa']['groups'][group]['forwarding_vrf'] }}"
  {% endif -%}
  {% if 'source-interface' in vars['aaa']['groups'][group] -%}
  - " ip tacacs source-interface {{ vars['aaa']['groups'][group]['source-interface'] }}"
  {% endif -%}
{% endfor -%}
{% endif -%}
